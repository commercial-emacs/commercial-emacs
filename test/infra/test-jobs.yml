
test-lib-src-inotify:
  stage: normal
  extends: [.job-template]
  needs:
    - job: build-image-inotify
      optional: true
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
      when: never
    - changes:
        - lib-src/*.{h,c}
        - test/lib-src/*.el
        - test/lib-src/*resources/**
  artifacts:
    name: ${test_name}
    public: true
    expire_in: 1 week
    paths:
      - ${test_name}/lib-src/*.log
    when: always
  variables:
    target: emacs-inotify
    make_params: "-C test check-lib-src"

test-lisp-inotify:
  stage: normal
  extends: [.job-template]
  needs:
    - job: build-image-inotify
      optional: true
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
      when: never
    - changes:
        - lisp/*.el
        - test/lisp/*.el
        - test/lisp/*resources/**
  artifacts:
    name: ${test_name}
    public: true
    expire_in: 1 week
    paths:
      - ${test_name}/lisp/*.log
    when: always
  variables:
    target: emacs-inotify
    make_params: "-C test check-lisp"

test-lisp-calc-inotify:
  stage: normal
  extends: [.job-template]
  needs:
    - job: build-image-inotify
      optional: true
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
      when: never
    - changes:
        - lisp/calc/*.el
        - test/lisp/calc/*.el
        - test/lisp/calc/*resources/**
  artifacts:
    name: ${test_name}
    public: true
    expire_in: 1 week
    paths:
      - ${test_name}/lisp/calc/*.log
    when: always
  variables:
    target: emacs-inotify
    make_params: "-C test check-lisp-calc"

test-lisp-calendar-inotify:
  stage: normal
  extends: [.job-template]
  needs:
    - job: build-image-inotify
      optional: true
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
      when: never
    - changes:
        - lisp/calendar/*.el
        - test/lisp/calendar/*.el
        - test/lisp/calendar/*resources/**
  artifacts:
    name: ${test_name}
    public: true
    expire_in: 1 week
    paths:
      - ${test_name}/lisp/calendar/*.log
    when: always
  variables:
    target: emacs-inotify
    make_params: "-C test check-lisp-calendar"

test-lisp-cedet-inotify:
  stage: normal
  extends: [.job-template]
  needs:
    - job: build-image-inotify
      optional: true
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
      when: never
    - changes:
        - lisp/cedet/*.el
        - test/lisp/cedet/*.el
        - test/lisp/cedet/*resources/**
  artifacts:
    name: ${test_name}
    public: true
    expire_in: 1 week
    paths:
      - ${test_name}/lisp/cedet/*.log
    when: always
  variables:
    target: emacs-inotify
    make_params: "-C test check-lisp-cedet"

test-lisp-cedet-semantic-inotify:
  stage: normal
  extends: [.job-template]
  needs:
    - job: build-image-inotify
      optional: true
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
      when: never
    - changes:
        - lisp/cedet/semantic/*.el
        - test/lisp/cedet/semantic/*.el
        - test/lisp/cedet/semantic/*resources/**
  artifacts:
    name: ${test_name}
    public: true
    expire_in: 1 week
    paths:
      - ${test_name}/lisp/cedet/semantic/*.log
    when: always
  variables:
    target: emacs-inotify
    make_params: "-C test check-lisp-cedet-semantic"

test-lisp-cedet-semantic-bovine-inotify:
  stage: normal
  extends: [.job-template]
  needs:
    - job: build-image-inotify
      optional: true
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
      when: never
    - changes:
        - lisp/cedet/semantic/bovine/*.el
        - test/lisp/cedet/semantic/bovine/*.el
        - test/lisp/cedet/semantic/bovine/*resources/**
  artifacts:
    name: ${test_name}
    public: true
    expire_in: 1 week
    paths:
      - ${test_name}/lisp/cedet/semantic/bovine/*.log
    when: always
  variables:
    target: emacs-inotify
    make_params: "-C test check-lisp-cedet-semantic-bovine"

test-lisp-cedet-srecode-inotify:
  stage: normal
  extends: [.job-template]
  needs:
    - job: build-image-inotify
      optional: true
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
      when: never
    - changes:
        - lisp/cedet/srecode/*.el
        - test/lisp/cedet/srecode/*.el
        - test/lisp/cedet/srecode/*resources/**
  artifacts:
    name: ${test_name}
    public: true
    expire_in: 1 week
    paths:
      - ${test_name}/lisp/cedet/srecode/*.log
    when: always
  variables:
    target: emacs-inotify
    make_params: "-C test check-lisp-cedet-srecode"

test-lisp-emacs-lisp-inotify:
  stage: normal
  extends: [.job-template]
  needs:
    - job: build-image-inotify
      optional: true
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
      when: never
    - changes:
        - lisp/emacs-lisp/*.el
        - test/lisp/emacs-lisp/*.el
        - test/lisp/emacs-lisp/*resources/**
  artifacts:
    name: ${test_name}
    public: true
    expire_in: 1 week
    paths:
      - ${test_name}/lisp/emacs-lisp/*.log
    when: always
  variables:
    target: emacs-inotify
    make_params: "-C test check-lisp-emacs-lisp"

test-lisp-emacs-lisp-eieio-tests-inotify:
  stage: normal
  extends: [.job-template]
  needs:
    - job: build-image-inotify
      optional: true
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
      when: never
    - changes:
        - lisp/emacs-lisp/eieio*.el
        - test/lisp/emacs-lisp/eieio-tests/*.el
        - test/lisp/emacs-lisp/eieio-tests/*resources/**
  artifacts:
    name: ${test_name}
    public: true
    expire_in: 1 week
    paths:
      - ${test_name}/lisp/emacs-lisp/eieio-tests/*.log
    when: always
  variables:
    target: emacs-inotify
    make_params: "-C test check-lisp-emacs-lisp-eieio-tests"

test-lisp-emacs-lisp-faceup-tests-inotify:
  stage: normal
  extends: [.job-template]
  needs:
    - job: build-image-inotify
      optional: true
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
      when: never
    - changes:
        - lisp/emacs-lisp/faceup*.el
        - test/lisp/emacs-lisp/faceup-tests/*.el
        - test/lisp/emacs-lisp/faceup-tests/*resources/**
  artifacts:
    name: ${test_name}
    public: true
    expire_in: 1 week
    paths:
      - ${test_name}/lisp/emacs-lisp/faceup-tests/*.log
    when: always
  variables:
    target: emacs-inotify
    make_params: "-C test check-lisp-emacs-lisp-faceup-tests"

test-lisp-emulation-inotify:
  stage: normal
  extends: [.job-template]
  needs:
    - job: build-image-inotify
      optional: true
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
      when: never
    - changes:
        - lisp/emulation/*.el
        - test/lisp/emulation/*.el
        - test/lisp/emulation/*resources/**
  artifacts:
    name: ${test_name}
    public: true
    expire_in: 1 week
    paths:
      - ${test_name}/lisp/emulation/*.log
    when: always
  variables:
    target: emacs-inotify
    make_params: "-C test check-lisp-emulation"

test-lisp-erc-inotify:
  stage: normal
  extends: [.job-template]
  needs:
    - job: build-image-inotify
      optional: true
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
      when: never
    - changes:
        - lisp/erc/*.el
        - test/lisp/erc/*.el
        - test/lisp/erc/*resources/**
  artifacts:
    name: ${test_name}
    public: true
    expire_in: 1 week
    paths:
      - ${test_name}/lisp/erc/*.log
    when: always
  variables:
    target: emacs-inotify
    make_params: "-C test check-lisp-erc"

test-lisp-eshell-inotify:
  stage: normal
  extends: [.job-template]
  needs:
    - job: build-image-inotify
      optional: true
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
      when: never
    - changes:
        - lisp/eshell/*.el
        - test/lisp/eshell/*.el
        - test/lisp/eshell/*resources/**
  artifacts:
    name: ${test_name}
    public: true
    expire_in: 1 week
    paths:
      - ${test_name}/lisp/eshell/*.log
    when: always
  variables:
    target: emacs-inotify
    make_params: "-C test check-lisp-eshell"

test-lisp-gnus-inotify:
  stage: normal
  extends: [.job-template]
  needs:
    - job: build-image-inotify
      optional: true
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
      when: never
    - changes:
        - lisp/gnus/*.el
        - test/lisp/gnus/*.el
        - test/lisp/gnus/*resources/**
  artifacts:
    name: ${test_name}
    public: true
    expire_in: 1 week
    paths:
      - ${test_name}/lisp/gnus/*.log
    when: always
  variables:
    target: emacs-inotify
    make_params: "-C test check-lisp-gnus"

test-lisp-image-inotify:
  stage: normal
  extends: [.job-template]
  needs:
    - job: build-image-inotify
      optional: true
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
      when: never
    - changes:
        - lisp/image/*.el
        - test/lisp/image/*.el
        - test/lisp/image/*resources/**
  artifacts:
    name: ${test_name}
    public: true
    expire_in: 1 week
    paths:
      - ${test_name}/lisp/image/*.log
    when: always
  variables:
    target: emacs-inotify
    make_params: "-C test check-lisp-image"

test-lisp-international-inotify:
  stage: normal
  extends: [.job-template]
  needs:
    - job: build-image-inotify
      optional: true
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
      when: never
    - changes:
        - lisp/international/*.el
        - test/lisp/international/*.el
        - test/lisp/international/*resources/**
  artifacts:
    name: ${test_name}
    public: true
    expire_in: 1 week
    paths:
      - ${test_name}/lisp/international/*.log
    when: always
  variables:
    target: emacs-inotify
    make_params: "-C test check-lisp-international"

test-lisp-mail-inotify:
  stage: normal
  extends: [.job-template]
  needs:
    - job: build-image-inotify
      optional: true
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
      when: never
    - changes:
        - lisp/mail/*.el
        - test/lisp/mail/*.el
        - test/lisp/mail/*resources/**
  artifacts:
    name: ${test_name}
    public: true
    expire_in: 1 week
    paths:
      - ${test_name}/lisp/mail/*.log
    when: always
  variables:
    target: emacs-inotify
    make_params: "-C test check-lisp-mail"

test-lisp-mh-e-inotify:
  stage: normal
  extends: [.job-template]
  needs:
    - job: build-image-inotify
      optional: true
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
      when: never
    - changes:
        - lisp/mh-e/*.el
        - test/lisp/mh-e/*.el
        - test/lisp/mh-e/*resources/**
  artifacts:
    name: ${test_name}
    public: true
    expire_in: 1 week
    paths:
      - ${test_name}/lisp/mh-e/*.log
    when: always
  variables:
    target: emacs-inotify
    make_params: "-C test check-lisp-mh-e"

test-lisp-net-inotify:
  stage: normal
  extends: [.job-template]
  needs:
    - job: build-image-inotify
      optional: true
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
      when: never
    - changes:
        - lisp/net/*.el
        - test/lisp/net/*.el
        - test/lisp/net/*resources/**
  artifacts:
    name: ${test_name}
    public: true
    expire_in: 1 week
    paths:
      - ${test_name}/lisp/net/*.log
    when: always
  variables:
    target: emacs-inotify
    make_params: "-C test check-lisp-net"

test-lisp-nxml-inotify:
  stage: normal
  extends: [.job-template]
  needs:
    - job: build-image-inotify
      optional: true
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
      when: never
    - changes:
        - lisp/nxml/*.el
        - test/lisp/nxml/*.el
        - test/lisp/nxml/*resources/**
  artifacts:
    name: ${test_name}
    public: true
    expire_in: 1 week
    paths:
      - ${test_name}/lisp/nxml/*.log
    when: always
  variables:
    target: emacs-inotify
    make_params: "-C test check-lisp-nxml"

test-lisp-obsolete-inotify:
  stage: normal
  extends: [.job-template]
  needs:
    - job: build-image-inotify
      optional: true
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
      when: never
    - changes:
        - lisp/obsolete/*.el
        - test/lisp/obsolete/*.el
        - test/lisp/obsolete/*resources/**
  artifacts:
    name: ${test_name}
    public: true
    expire_in: 1 week
    paths:
      - ${test_name}/lisp/obsolete/*.log
    when: always
  variables:
    target: emacs-inotify
    make_params: "-C test check-lisp-obsolete"

test-lisp-org-inotify:
  stage: normal
  extends: [.job-template]
  needs:
    - job: build-image-inotify
      optional: true
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
      when: never
    - changes:
        - lisp/org/*.el
        - test/lisp/org/*.el
        - test/lisp/org/*resources/**
  artifacts:
    name: ${test_name}
    public: true
    expire_in: 1 week
    paths:
      - ${test_name}/lisp/org/*.log
    when: always
  variables:
    target: emacs-inotify
    make_params: "-C test check-lisp-org"

test-lisp-play-inotify:
  stage: normal
  extends: [.job-template]
  needs:
    - job: build-image-inotify
      optional: true
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
      when: never
    - changes:
        - lisp/play/*.el
        - test/lisp/play/*.el
        - test/lisp/play/*resources/**
  artifacts:
    name: ${test_name}
    public: true
    expire_in: 1 week
    paths:
      - ${test_name}/lisp/play/*.log
    when: always
  variables:
    target: emacs-inotify
    make_params: "-C test check-lisp-play"

test-lisp-progmodes-inotify:
  stage: normal
  extends: [.job-template]
  needs:
    - job: build-image-inotify
      optional: true
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
      when: never
    - changes:
        - lisp/progmodes/*.el
        - test/lisp/progmodes/*.el
        - test/lisp/progmodes/*resources/**
  artifacts:
    name: ${test_name}
    public: true
    expire_in: 1 week
    paths:
      - ${test_name}/lisp/progmodes/*.log
    when: always
  variables:
    target: emacs-inotify
    make_params: "-C test check-lisp-progmodes"

test-lisp-so-long-tests-inotify:
  stage: normal
  extends: [.job-template]
  needs:
    - job: build-image-inotify
      optional: true
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
      when: never
    - changes:
        - lisp/so-long*.el
        - test/lisp/so-long-tests/*.el
        - test/lisp/so-long-tests/*resources/**
  artifacts:
    name: ${test_name}
    public: true
    expire_in: 1 week
    paths:
      - ${test_name}/lisp/so-long-tests/*.log
    when: always
  variables:
    target: emacs-inotify
    make_params: "-C test check-lisp-so-long-tests"

test-lisp-term-inotify:
  stage: normal
  extends: [.job-template]
  needs:
    - job: build-image-inotify
      optional: true
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
      when: never
    - changes:
        - lisp/term/*.el
        - test/lisp/term/*.el
        - test/lisp/term/*resources/**
  artifacts:
    name: ${test_name}
    public: true
    expire_in: 1 week
    paths:
      - ${test_name}/lisp/term/*.log
    when: always
  variables:
    target: emacs-inotify
    make_params: "-C test check-lisp-term"

test-lisp-textmodes-inotify:
  stage: normal
  extends: [.job-template]
  needs:
    - job: build-image-inotify
      optional: true
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
      when: never
    - changes:
        - lisp/textmodes/*.el
        - test/lisp/textmodes/*.el
        - test/lisp/textmodes/*resources/**
  artifacts:
    name: ${test_name}
    public: true
    expire_in: 1 week
    paths:
      - ${test_name}/lisp/textmodes/*.log
    when: always
  variables:
    target: emacs-inotify
    make_params: "-C test check-lisp-textmodes"

test-lisp-url-inotify:
  stage: normal
  extends: [.job-template]
  needs:
    - job: build-image-inotify
      optional: true
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
      when: never
    - changes:
        - lisp/url/*.el
        - test/lisp/url/*.el
        - test/lisp/url/*resources/**
  artifacts:
    name: ${test_name}
    public: true
    expire_in: 1 week
    paths:
      - ${test_name}/lisp/url/*.log
    when: always
  variables:
    target: emacs-inotify
    make_params: "-C test check-lisp-url"

test-lisp-vc-inotify:
  stage: normal
  extends: [.job-template]
  needs:
    - job: build-image-inotify
      optional: true
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
      when: never
    - changes:
        - lisp/vc/*.el
        - test/lisp/vc/*.el
        - test/lisp/vc/*resources/**
  artifacts:
    name: ${test_name}
    public: true
    expire_in: 1 week
    paths:
      - ${test_name}/lisp/vc/*.log
    when: always
  variables:
    target: emacs-inotify
    make_params: "-C test check-lisp-vc"

test-misc-inotify:
  stage: normal
  extends: [.job-template]
  needs:
    - job: build-image-inotify
      optional: true
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
      when: never
    - changes:
        - admin/*.el
        - test/misc/*.el
        - test/misc/*resources/**
  artifacts:
    name: ${test_name}
    public: true
    expire_in: 1 week
    paths:
      - ${test_name}/misc/*.log
    when: always
  variables:
    target: emacs-inotify
    make_params: "-C test check-misc"

test-src-inotify:
  stage: normal
  extends: [.job-template]
  needs:
    - job: build-image-inotify
      optional: true
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
      when: never
    - changes:
        - src/*.{h,c}
        - test/src/*.el
        - test/src/*resources/**
  artifacts:
    name: ${test_name}
    public: true
    expire_in: 1 week
    paths:
      - ${test_name}/src/*.log
    when: always
  variables:
    target: emacs-inotify
    make_params: "-C test check-src"
